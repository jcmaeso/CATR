dirpath = fullfile(pwd,"diagrams");
phi_step = 1;
theta_step = 1;
phi = 0:phi_step:360;
theta = 0:theta_step:180;
frequencies = 80e9:10e9:120e9;
[phi, theta] = meshgrid(phi,theta);
[Etheta, Ephi] = cosq(theta,phi,15);
fileID = fopen(fullfile(pwd,"farfieldsources2.ffs"),'w+');
save_diagrams2file(fileID,frequencies,Etheta,Ephi,theta,phi);
fclose(fileID);

function[] = save_diagrams2file(fileID,frequencies,Etheta,Ephi,theta,phi)
    fprintf(fileID,['// CST Farfield Source File \n'...
            '// Version: \n'...
            '3.0 \n'... 
            '// Data Type \n'...
            'Farfield \n'... 
            '// #Frequencies \n'...
            '%d\n'...
            '// Position \n'...
            '0.000000e+00 0.000000e+00 7.435800e-04 \n'... 
            '// zAxis\n'...
            '0.000000e+00 0.000000e+00 1.000000e+00 \n'... 
            '// xAxis\n'...
            '1.000000e+00 0.000000e+00 0.000000e+00 \n'...
            '// Radiated/Accepted/Stimulated Power , Frequency \n'],length(frequencies));
        
    [n_theta,n_phi] = size(theta);
    fprintf(fileID,[
            '4.777025e-01 \n'... 
            '4.997997e-01 \n'...
            '5.000000e-01 \n'...
            '%0.6e \n\n'],frequencies);
    for i = 1:numel(frequencies)
        fprintf(fileID,'%d %d \n',n_phi,n_theta);
        for n = 1:numel(theta)
            fprintf(fileID,'%8.3f%8.3f%17.8e%17.8e%16.8e%17.8e\n',...
            [phi(n) theta(n) real(Etheta(n)) imag(Etheta(n)) real(Ephi(n)) imag(Ephi(n))]);
        end
    end
end
