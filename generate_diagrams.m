dirpath = fullfile(pwd,"diagrams");
points_phi = 21;
points_theta = 31;
phi = 0:1:360;
theta = 0:1:180;
[phi, theta] = meshgrid(phi,theta);
[Etheta, Ephi] = cosq(theta,phi,5.5);
save_diagram2file(fullfile(dirpath,"prueba.ffs"),9e9,Etheta,Ephi,theta,phi);

for i=8:120
    save_diagram2file(fullfile(dirpath,sprintf("%d.ffs",i)),i*1e9,Etheta,Ephi,theta,phi);
end

function[] = save_diagram2file(route,frequency,Etheta,Ephi,theta,phi)
    fileID = fopen(route,'w+');
    [n_theta,n_phi] = size(theta);
    fprintf(fileID,['// CST Farfield Source File \n'...
            '// Version: \n'...
            '3.0 \n'... 
            '// Data Type \n'...
            'Farfield \n'... 
            '// #Frequencies \n'...
            '1\n'...
            '// Position \n'...
            '0.000000e+00 0.000000e+00 7.435800e-04 \n'... 
            '// zAxis\n'...
            '0.000000e+00 0.000000e+00 1.000000e+00 \n'... 
            '// xAxis\n'...
            '1.000000e+00 0.000000e+00 0.000000e+00 \n'... 
            '// Radiated/Accepted/Stimulated Power , Frequency \n'... 
            '4.777025e-01 \n'... 
            '4.997997e-01 \n'...
            '5.000000e-01 \n'...
            '%0.6e \n'...
            '// >> Total #phi samples, total #theta samples \n'...
            '%d %d \n'],frequency,n_phi,n_theta);
    for n = 1:numel(theta)
        fprintf(fileID,'%8.3f%8.3f%17.8e%17.8e%16.8e%17.8e\n',...
        [phi(n) theta(n) real(Etheta(n)) imag(Etheta(n)) real(Ephi(n)) imag(Ephi(n))]);
    end
    fclose(fileID);
end
